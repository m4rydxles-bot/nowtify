<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ayarlar - Nowtify</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="logo">NOWTIFY</div>
            <div class="nav-links">
                <a href="./dashboard.html">Dashboard</a>
                <a href="#" id="profile-link">Profilim</a>
                <a href="./settings.html">Ayarlar</a>
                <a href="#" onclick="logout()">Ã‡Ä±kÄ±ÅŸ</a>
            </div>
        </div>
    </nav>

    <div class="container">
        <div class="dashboard-header">
            <h1>âš™ï¸ Ayarlar</h1>
            <p>Profil tercihlerini Ã¶zelleÅŸtir</p>
        </div>

        <div id="success-message" class="success-message" style="display: none;"></div>
        <div id="error-message" class="error-message" style="display: none;"></div>

        <!-- Profile Settings -->
        <div class="settings-section">
            <h2>ğŸ‘¤ Profil AyarlarÄ±</h2>
            
            <div class="setting-item">
                <div class="setting-info">
                    <h3>KullanÄ±cÄ± AdÄ±</h3>
                    <p id="current-username">username</p>
                </div>
            </div>

            <div class="setting-item">
                <div class="setting-info">
                    <h3>E-posta</h3>
                    <p id="current-email">email@example.com</p>
                </div>
            </div>
        </div>

        <!-- Privacy Settings -->
        <div class="settings-section">
            <h2>ğŸ”’ Gizlilik AyarlarÄ±</h2>
            
            <div class="setting-item">
                <div class="setting-info">
                    <h3>Profil GÃ¶rÃ¼nÃ¼rlÃ¼ÄŸÃ¼</h3>
                    <p>Profilin herkese aÃ§Ä±k mÄ± yoksa gizli mi olsun?</p>
                </div>
                <label class="toggle-switch">
                    <input type="checkbox" id="privacy-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <p style="color: var(--text-secondary); font-size: 14px; margin-top: 10px;">
                AÃ§Ä±k = Herkese AÃ§Ä±k | KapalÄ± = Gizli
            </p>
        </div>

        <!-- History Settings -->
        <div class="settings-section">
            <h2>ğŸ“œ Dinleme GeÃ§miÅŸi AyarlarÄ±</h2>
            
            <div class="setting-item" style="display: block;">
                <div class="setting-info" style="margin-bottom: 15px;">
                    <h3>GÃ¶sterilecek ÅarkÄ± SayÄ±sÄ±</h3>
                    <p>Profilinde kaÃ§ adet ÅŸarkÄ± geÃ§miÅŸi gÃ¶rÃ¼nsÃ¼n?</p>
                </div>
                <select id="history-limit" class="form-group" style="width: 100%; padding: 12px; background: var(--dark-bg); border: 1px solid rgba(255,255,255,0.1); border-radius: 10px; color: var(--text-primary); font-size: 16px;">
                    <option value="10">10 ÅarkÄ±</option>
                    <option value="15">15 ÅarkÄ±</option>
                    <option value="25">25 ÅarkÄ±</option>
                    <option value="30">30 ÅarkÄ±</option>
                    <option value="45">45 ÅarkÄ±</option>
                    <option value="50">50 ÅarkÄ±</option>
                </select>
            </div>
        </div>

        <!-- Spotify Settings -->
        <div class="settings-section">
            <h2>ğŸµ Spotify BaÄŸlantÄ±sÄ±</h2>
            
            <div class="setting-item">
                <div class="setting-info">
                    <h3>Spotify Durumu</h3>
                    <p id="spotify-status">BaÄŸlÄ± deÄŸil</p>
                </div>
                <button id="reconnect-spotify" class="btn btn-primary">Yeniden BaÄŸlan</button>
            </div>
        </div>

        <!-- Save Button -->
        <div style="text-align: center; margin-top: 30px;">
            <button id="save-settings" class="btn btn-primary" style="min-width: 200px;">AyarlarÄ± Kaydet</button>
        </div>
    </div>

    <script src="utils.js"></script>
    <script>
        requireAuth();

        const user = getCurrentUser();
        document.getElementById('profile-link').href = `./profile.html?user=${user.username}`;
        document.getElementById('current-username').textContent = user.username;

        // Load current settings
        async function loadSettings() {
            try {
                const data = await apiRequest('/api/auth/me');
                
                document.getElementById('current-email').textContent = data.user.email;
                document.getElementById('privacy-toggle').checked = data.user.profile_visibility === 'public';
                document.getElementById('history-limit').value = data.user.history_limit || 25;
                
                if (data.user.spotify_connected) {
                    document.getElementById('spotify-status').textContent = 'BaÄŸlÄ± âœ…';
                } else {
                    document.getElementById('spotify-status').textContent = 'BaÄŸlÄ± deÄŸil âŒ';
                }
            } catch (error) {
                showError('Ayarlar yÃ¼klenirken hata oluÅŸtu');
            }
        }

        // Save settings
        document.getElementById('save-settings').addEventListener('click', async () => {
            hideMessage('success-message');
            hideMessage('error-message');

            const profileVisibility = document.getElementById('privacy-toggle').checked ? 'public' : 'private';
            const historyLimit = parseInt(document.getElementById('history-limit').value);

            try {
                await apiRequest('/api/users/settings', {
                    method: 'PUT',
                    body: JSON.stringify({
                        profile_visibility: profileVisibility,
                        history_limit: historyLimit
                    })
                });

                showSuccess('Ayarlar baÅŸarÄ±yla kaydedildi! âœ…');
                setTimeout(() => hideMessage('success-message'), 3000);
            } catch (error) {
                showError('Ayarlar kaydedilirken hata oluÅŸtu: ' + error.message);
            }
        });

        // Reconnect Spotify
        document.getElementById('reconnect-spotify').addEventListener('click', async () => {
            try {
                const data = await apiRequest('/api/spotify/login');
                window.location.href = data.auth_url;
            } catch (error) {
                showError('Spotify baÄŸlantÄ± hatasÄ±: ' + error.message);
            }
        });

        loadSettings();
    </script>
</body>
</html>
